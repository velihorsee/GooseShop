@page "/login"
@using Microsoft.AspNetCore.Components.Web
@using GooseShop.Services
@inject AuthService AuthService
@inject NavigationManager Nav
@rendermode InteractiveServer

<div class="z-auth-container">
    <div class="z-auth-box shadow-hard">
        @* ТАБИ: ВХІД / РЕЄСТРАЦІЯ *@
        <div class="d-flex border-bottom-bold mb-4">
            @* Додав SwitchTab, щоб очищати помилки при переході *@
            <button class="z-tab-btn @(isLogin ? "active" : "")" @onclick="() => SwitchTab(true)">ВХІД</button>
            <button class="z-tab-btn @(!isLogin ? "active" : "")" @onclick="() => SwitchTab(false)">РЕЄСТРАЦІЯ</button>
        </div>

        <div class="p-4 pt-2">
            <h2 class="fw-black text-uppercase mb-4 text-center">
                @(isLogin ? "З ПОВЕРНЕННЯМ, ГУСЬ!" : "ВСТУПАЙ У ГЕНГ!") 🦢
            </h2>

            @if (!isLogin)
            {
                <div class="mb-3">
                    <label class="z-label">Як тебе звати?</label>
                    @* Додав spellcheck="false", щоб червоне не підкреслювало *@
                    <input @bind="userName" type="text" class="z-input shadow-pixel w-100" placeholder="Goose..." spellcheck="false" />
                </div>
            }

            <div class="mb-3">
                <label class="z-label">Твій Email</label>
                <input @bind="email" type="email" class="z-input shadow-pixel w-100" placeholder="vash@email.com" />
            </div>

            <div class="mb-4">
                <label class="z-label">Секретний пароль</label>
                <input @bind="password" type="password" class="z-input shadow-pixel w-100" placeholder="••••••••" />
            </div>

            @if (!string.IsNullOrEmpty(error))
            {
                <div class="z-alert mb-4">@error</div>
            }

            @* УВАГА: Тут я змінив клас на z-btn-auth, 
               щоб запрацювала та сама "дика" анімація з CSS! 
            *@
            <button class="z-btn-auth shadow-pixel py-3" @onclick="HandleAuth">
                @(isLogin ? "ПОГНАЛИ! 🚀" : "СТАТИ ГУСЕМ 🔥")
            </button>
        </div>
    </div>
</div>

@code {
    private bool isLogin = true;
    private string userName = "";
    private string email = "";
    private string password = "";
    private string error = "";

    private void SwitchTab(bool login)
    {
        isLogin = login;
        error = ""; // Очищаємо помилку, коли гусак передумав
    }

    private async Task HandleAuth()
    {
        error = "";
        if (string.IsNullOrEmpty(email) || string.IsNullOrEmpty(password))
        {
            error = "Заповни всі поля, бро!";
            return;
        }

        bool success = isLogin
            ? await AuthService.Login(email, password)
            : await AuthService.Register(userName, email, password);

        if (success)
            Nav.NavigateTo("/profile");
        else
            error = isLogin ? "Невірний email або пароль" : "Помилка при реєстрації (може Email вже зайнятий?)";
    }
}